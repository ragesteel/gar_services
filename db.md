# Загрузка данных в базу

Тут и создание схемы и собственно сам процесс загрузки.

## Вехи разработки

### 2025-09-12 14:55 MSK

Хотел было называть подпроект просто `load` но тогда не понятно, это загрузка архивов или загрузка в сразу в базу данных. Хотя, с другой стороны, можно называть просто `db`, ведь там не только сама загрузка, но и создание схемы!

### 2025-09-12 22:04 MSK

Поначалу казалось, что самым сложным будет генерация схемы. Но нет, она вроде довольно быстро получилась.
Конечно после всех подготовительных этапов.
Дальше нужно было создать базу. Локально у меня PostgreSQL под Windows запущен. Но вот pgAdmin поломался. 
Посмотрел на инструмент работы с базами, который у OpenIDE есть на Market'е — фигня какая-то. Через-чур усложнённый.
Хоть бери да ставь инструмент работы с базами из моей подписки. Там и ключик должен быть.

Ну ладно: решил, буду из командной строки psql запускать, так ещё ему пароль в командной строчке не укажешь, нужно в специальный файл записывать.
Нашёл команды создания TableSpace чтобы базу на другом диске расположить. Потом и пользователя с базой создал.

А вот дальше с Liquibase — облом. У меня есть тут учебный проект со Spring'ом где Liquibase используется. Далее я хочу конфигурацию в файле `.yml`, а по умолчанию liquibase ищет `.yaml`.
Да можно переопределить в `application.yml`, но нужно не просто имя указать, а полный путь `classpath:/db/changelog/db.changelog-master.yml`.
И если я хочу сделать include файла, который лежит рядом, мне и ему нужно полный путь указать! Хотя вот нет, сейчас глянул в документацию, можно поставить флаг `relativeToChangelogFile` в true и тогда без полного пути можно обойтись.

Но он ругается на createTable — mapping values are not allowed here. Хотя я брал за пример рабочий файл изменений, но тут вот такие непонятки.
Я конечно в процессе ещё сделал чтобы GenerateSchema сразу в нужный файл писал, но вот что ему не нравится — ещё предстоит разобраться!

Прочитав про [YAML из Ада](https://habr.com/ru/articles/710414/) что-то мне подумалось о том, что может мне перевести из YAML в JSON. Но посмотрев на примеры JSON уже захотелось обратно в XML. Тут хоть сразу автодополнение заработал, которые подтянет информацию из схемы.

### 2025-09-12 23:50 MSK

В итоге было две проблемы — забыл про «changes:» и второе — нужно было вернуть отступы, как по мне там их прям многовато.

### 2025-09-20 01:17 MSK

Вот вроде классная штука — MapStruct, но нет простых способов сделать так, чтобы она вызывала метода `PreparedStatement`'а! ChatGPT предлагает какую-то шляпу с обёрткой, которая не работает. А писать всю установку параметров вручную не хочется…
